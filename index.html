<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Translator</title>
</head>
<body>
    <h1>أداة ترجمة الفصول</h1>

    <!-- استيراد الصور -->
    <form id="importForm">
        <label for="chapterLink">رابط الفصل:</label>
        <input type="text" id="chapterLink" placeholder="أدخل رابط الفصل">
        
        <label for="folderName">اسم المجلد:</label>
        <input type="text" id="folderName" placeholder="اسم المجلد">

        <label for="tags">الفلاتر (Tags):</label>
        <input type="text" id="tags" placeholder="أدخل الفلاتر مفصولة بفواصل">

        <button type="submit">استيراد</button>
    </form>

    <!-- رفع الصور -->
    <div id="results"></div>
    <button id="uploadButton" style="display: none;">رفع الفصل</button>

    <!-- البحث -->
    <form id="searchForm">
        <label for="searchQuery">بحث:</label>
        <input type="text" id="searchQuery" placeholder="أدخل النص">
        <button type="submit">بحث</button>
    </form>
    <div id="searchResults"></div>

    <script>
        const importForm = document.getElementById('importForm');
        const results = document.getElementById('results');
        const uploadButton = document.getElementById('uploadButton');
        const searchForm = document.getElementById('searchForm');
        const searchResults = document.getElementById('searchResults');

        importForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const chapterLink = document.getElementById('chapterLink').value;
            const folderName = document.getElementById('folderName').value;
            const tags = document.getElementById('tags').value.split(',');

            const response = await fetch('http://127.0.0.1:5000/import', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chapterLink, folderName, tags })
            });

            const data = await response.json();
            if (data.error) {
                results.innerHTML = `<p>Error: ${data.error}</p>`;
            } else {
                results.innerHTML = data.images.map((img, index) => `
                    <div>
                        <img src="${img.image}" alt="Image ${index + 1}" width="200">
                        <textarea>${img.translated_text}</textarea>
                    </div>
                `).join('');
                uploadButton.style.display = 'block';
            }
        });

        uploadButton.addEventListener('click', async () => {
            const images = Array.from(document.querySelectorAll('textarea')).map((textarea, index) => ({
                image: `temp_images/${(index + 1).toString().padStart(3, '0')}.jpg`,
                translated_text: textarea.value
            }));

            const folderName = document.getElementById('folderName').value;
            const tags = document.getElementById('tags').value.split(',');

            const response = await fetch('http://127.0.0.1:5000/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ images, folderName, tags })
            });

            const data = await response.json();
            alert(data.message || data.error);
        });

        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = document.getElementById('searchQuery').value;

            const response = await fetch(`http://127.0.0.1:5000/search?query=${query}`);
            const data = await response.json();

            searchResults.innerHTML = data.results.length
                ? `<ul>${data.results.map(result => `<li>${result}</li>`).join('')}</ul>`
                : `<p>لا توجد نتائج</p>`;
        });
    </script>
</body>
</html>
